
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>OpenSSL CA, Certificate and Keytool Management with Ansible</title>
    <meta name="description" content="Managing a CA and certificates with Ansible">
    <meta name="author" content="James Whetsell">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">zer0glitch</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        

    <div class="container-narrow">


<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>24 July 2016</span>
    </div>
    <div class="content">
      <p><strong><em>Introduction</em></strong></p>

<p>Ansible is a fast growing product for provisioning of compute instances, and software on the computer instances.  A simple way way of managing certificates and users is through the use of System Integrity Management Platform (SIMP).  Unfortunately, SIMP uses puppet to manage certificates and servers, and this is a large commitment to manage a cluster for development purposes.</p>

<p>The OpenSSL module can solve the issue of certificate management in Ansible.  The module, or extension of Ansible, allows for complete CA, Certificate, and Keystore management.  The system will work existing CAs or create a custom CA for internal development.</p>

<p>Ansible-OpenSSL will create certificates that are compatible with Apache httpd, Apache Tomcat, Jboss, IIS, etc.  This includes server and client certificates for accessing the system.</p>

<p><strong><em>Installing the OpenSSL Module</em></strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone git@github.com:rclayton-the-terrible/Ansible-OpenSSL.git
</code></pre>
</div>

<p>Follow the installation instructions from the github <a href="https://github.com/rclayton-the-terrible/Ansible-OpenSSL">project</a>.</p>

<p><strong><em>Creating a CA</em></strong></p>

<p>The essential of certificate management is the Certificate Authority.  The Certificate Authority is responsible for being the master trust for a certificate chain.  As part of this responsibility it will sign the client and server certificate requests.</p>

<p>For our purproses we will create a CA if you already have a CA, then you can skip this step.  Our certitifcate directory will be <code class="highlighter-rouge">/etc/certs</code> the subject <code class="highlighter-rouge">/DC=com/DC=example/CN=CA</code>.  The format is typically the reverse of your DNS name.  To maintain uniquness in the system you can add additional information to the CN if you are planning on running multiple developemnt enviornments.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">Setup a CA</span>
  <span class="s">ca</span><span class="pi">:</span> <span class="s">certdir="/etc/certs" subj="/DC=com/DC=example/CN=CA/"</span>
</code></pre>
</div>

<p>You should now have a basic structure for your CA created under /etc/certs.  There are many suplimental files and directories that are created as part of this process, so do not delete from this directory.  It is safe to remove files in the server, keystores, client, and trustore directories, but not the directories themselves.</p>

<p><strong><em>Creating a server certificate</em></strong></p>

<p>After setting up our CA, we will now use the certificate module to create our server certificate to secure a web server.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">Create a Server Cert</span>
  <span class="s">certificate</span><span class="pi">:</span> <span class="s">cadir="/etc/certs" certname="www.example.com" subj="/DC=com/DC=example/CN=www/" p12password="changeit" subjectAltNames="DNS:client,DNS:www.example.com,IP:192.168.2.2"</span>
</code></pre>
</div>

<p>The files created for the certificate are stored in <code class="highlighter-rouge">/etc/certs/server/www.example.com</code></p>

<p>The task will create the following files:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>openssl.cnf - The definition of how the certificate request is generated
test.openampere.com.req.pem - The certificate request to be signed by the CA
test.openampere.com.cert.pem.pub - The signed certificate file
test.openampere.com.key.pem - The certificates key file
test.openampere.com.keycert.pem - The certificate and key file in one file
test.openampere.com.keycert.p12 - The PKCS12 file used to import into IIS or a java keystore
</code></pre>
</div>

<p>The next step is to install the certificate on the server of choice.  In our case, we are using the JBoss EAP Server as our web application server.  To accomplish this we first must create a truststore for the server to read.</p>

<p><strong><em>Creating a truststore</em></strong></p>

<p>By default the truststore will contain our default CA, and it should trust the itself for communications that are protected by client certificates.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">Create a java server trustore and trust the server hosts</span>
  <span class="s">keytool</span><span class="pi">:</span> <span class="s">cadir="/etc/certs" certname="www.example.com" store_password='changeit' hosts_to_trust="www.example.com"</span>
</code></pre>
</div>

<p>The result truststore is stored in <code class="highlighter-rouge">/etc/certs/truststore</code></p>

<p>The following file will be created:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">www.example.com.trust.jks</span>
</code></pre>
</div>

<p><strong><em>Creating a keystore</em></strong></p>

<p>The keystore will store the server certificate key for Jboss.  You must use the keystore util to create the keystore used by jboss.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">name</span><span class="pi">:</span> <span class="s">Create a java server keystore</span> 
  <span class="s">keytool</span><span class="pi">:</span> <span class="s">cadir="/etc/certs" certname="www.example.com" store_password='changeit'  certtype="keystore" src_password='changeit'</span>
</code></pre>
</div>

<p>This will creating the following files:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/etc/certs/keystores/www.example.com.keystore.jks
</code></pre>
</div>

<p>The foundation is now set for a simple example of securing a single server.  The certificates generated will secure several different types of servers.</p>

<p>Part Two of this article will examine a certificate system.  <a href="CA-Certificate-Keytool-with-Ansible-Part2">Part 2</a></p>


    </div>

    

    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2016/07/12/Packer-QEMU-errors" title="Packer QEMU Error">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2016/08/07/CA-Certificate-Keytool-with-Ansible-Part2" title="OpenSSL CA, Certificate and Keytool Management with Ansible Part 2">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2016 James Whetsell
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
        </p>
      </footer>

    </div>

    




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-123-12']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




  </body>
</html>

